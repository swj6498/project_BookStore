-- 기존 bookbuy 테이블 삭제
DROP TABLE bookbuy;

-- 주문 테이블: Order
CREATE TABLE Orders (
    order_id       NUMBER PRIMARY KEY,
    user_id        VARCHAR2(60) NOT NULL,
    order_date     DATE DEFAULT SYSDATE,
    total_quantity NUMBER NOT NULL,
    total_price    NUMBER NOT NULL,
    shipping_fee NUMBER DEFAULT 0,
    CONSTRAINT fk_orders_user FOREIGN KEY (user_id)
        REFERENCES users (user_id)
);

-- 주문 상세 테이블: OrderDetail
CREATE TABLE OrderDetail (
    order_detail_id NUMBER PRIMARY KEY,
    order_id        NUMBER NOT NULL,
    book_id         NUMBER NOT NULL,
    quantity        NUMBER DEFAULT 1,
    purchase_price  NUMBER NOT NULL,
    CONSTRAINT fk_orderdetail_order FOREIGN KEY (order_id)
        REFERENCES Orders (order_id) ON DELETE CASCADE,
    CONSTRAINT fk_orderdetail_book FOREIGN KEY (book_id)
        REFERENCES Book (book_id)
);

-- 시퀀스 생성: 주문 번호용
CREATE SEQUENCE orders_seq START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

-- 시퀀스 생성: 주문 상세 번호용
CREATE SEQUENCE orderdetail_seq START WITH 1 INCREMENT BY 1 NOCACHE NOCYCLE;

