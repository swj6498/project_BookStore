<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.dao.SearchDAO">

	<!-- 키워드로 책 검색 -->
	<select id="searchBooks" parameterType="string"
		resultType="com.boot.dto.SearchDTO">
		SELECT
		b.book_id,
		b.book_title,
		b.book_writer,
		b.book_pub,
		b.book_date,
		b.genre_id,
		g.genre_name,
		b.book_price,
		b.book_count,
		b.book_comm,
		b.book_isbn,
		b.book_image_path
		FROM Book b
		LEFT JOIN Genre g
		ON b.genre_id = g.genre_id
		WHERE LOWER(b.book_title)
		LIKE CONCAT('%',
		LOWER(#{keyword}), '%')
		OR LOWER(b.book_writer) LIKE
		CONCAT('%',
		LOWER(#{keyword}), '%')
		ORDER BY b.book_id ASC
	</select>

	<!-- 전체 책 리스트 -->
	<select id="getBookList"
		resultType="com.boot.dto.SearchDTO">
		SELECT
		b.book_id,
		b.book_title,
		b.book_writer,
		b.book_pub,
		b.book_date,
		b.genre_id,
		g.genre_name,
		b.book_price,
		b.book_count,
		b.book_comm,
		b.book_isbn,
		b.book_image_path
		FROM Book b
		LEFT JOIN Genre g
		ON b.genre_id = g.genre_id
		ORDER BY b.book_id ASC
	</select>

	<!-- 단일 책 조회 -->
	<select id="getBookById" parameterType="int"
		resultType="com.boot.dto.SearchDTO">
		SELECT
		b.book_id,
		b.book_title,
		b.book_writer,
		b.book_pub,
		b.book_date,
		b.genre_id,
		g.genre_name,
		b.book_price,
		b.book_count,
		b.book_comm,
		b.book_isbn,
		b.book_image_path
		FROM Book b
		LEFT JOIN Genre g
		ON b.genre_id = g.genre_id
		WHERE b.book_id =
		#{book_id}
	</select>

	<!-- 검색어 + 장르 필터 -->
	<select id="searchBooksByTitleAndGenre" parameterType="map"
		resultType="com.boot.dto.SearchDTO">
		SELECT
		b.book_id,
		b.book_title,
		b.book_writer,
		b.book_pub,
		b.book_date,
		b.genre_id,
		g.genre_name,
		b.book_price,
		b.book_count,
		b.book_comm,
		b.book_isbn,
		b.book_image_path
		FROM Book b
		LEFT JOIN Genre g ON b.genre_id = g.genre_id
		WHERE 1=1
		<if test="keyword != null and keyword != ''">
			AND (LOWER(b.book_title) LIKE '%' || LOWER(#{keyword}) || '%'
			OR
			LOWER(b.book_writer) LIKE '%' || LOWER(#{keyword}) || '%')
		</if>
		<if test="genreFilter != null">
			AND b.genre_id = #{genreFilter}
		</if>
		ORDER BY b.book_id ASC
	</select>


	<!-- 장르 목록 조회 -->
	<select id="getGenreList"
		resultType="com.boot.dto.GenreDTO">
		SELECT
		genre_id,
		genre_name
		FROM Genre
		ORDER BY genre_id ASC
	</select>

</mapper>