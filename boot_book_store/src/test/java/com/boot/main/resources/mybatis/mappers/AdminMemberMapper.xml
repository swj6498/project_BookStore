<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.boot.mapper.AdminMemberMapper">

    <!-- ✅ 전체 회원 조회 (ADMIN 제외) -->
    <select id="selectAllUsers" resultType="map">
        SELECT
            user_id             AS USER_ID,
            user_name           AS USER_NAME,
            user_nickname       AS USER_NICKNAME,
            user_email          AS USER_EMAIL,
            user_phone_num      AS USER_PHONE_NUM,
            login_type          AS LOGIN_TYPE,
            TO_CHAR(reg_date, 'YYYY-MM-DD HH24:MI:SS') AS REG_DATE,
            user_role           AS USER_ROLE
        FROM users
        WHERE user_role &lt;&gt; 'ADMIN'
        ORDER BY reg_date DESC
    </select>

    <!-- ✅ 단일 회원 조회 -->
    <select id="selectUserById" parameterType="string" resultType="map">
        SELECT
            user_id             AS USER_ID,
            user_name           AS USER_NAME,
            user_nickname       AS USER_NICKNAME,
            user_email          AS USER_EMAIL,
            user_phone_num      AS USER_PHONE_NUM,
            user_post_num       AS USER_POST_NUM,
            user_address        AS USER_ADDRESS,
            user_detail_address AS USER_DETAIL_ADDRESS,
            login_type          AS LOGIN_TYPE,
            TO_CHAR(reg_date, 'YYYY-MM-DD HH24:MI:SS') AS REG_DATE,
            user_role           AS USER_ROLE
        FROM users
        WHERE user_id = #{user_id}
    </select>

    <!-- ✅ 회원 정보 수정 (아이디, 이름, 권한, 로그인타입은 수정 안 함) -->
    <update id="updateUser" parameterType="map">
        UPDATE users
        SET user_email          = #{user_email},
            user_phone_num      = #{user_phone_num},
            user_nickname       = #{user_nickname},
            user_address        = #{user_address},
            user_detail_address = #{user_detail_address}
        WHERE user_id = #{user_id}
    </update>

    <!-- ✅ 회원 삭제 -->
    <delete id="deleteUser" parameterType="string">
        DELETE FROM users WHERE user_id = #{user_id}
    </delete>
    
    <!-- 권한 -->
    <update id="updateRole" parameterType="map">
    UPDATE users
    SET user_role = #{user_role}
    WHERE user_id = #{user_id}
</update>

<select id="selectAdmins" resultType="map">
    SELECT
        user_id AS USER_ID,
        user_name AS USER_NAME,
        user_email AS USER_EMAIL,
        user_role AS USER_ROLE
    FROM users
    WHERE user_role = 'ADMIN'
    ORDER BY user_id
</select>


</mapper>
